CMAKE_MINIMUM_REQUIRED(VERSION 2.8.11)

FUNCTION(PRINT_VAR  VAR_NAME)
  MESSAGE("${VAR_NAME} = '${${VAR_NAME}}'")
ENDFUNCTION()

PRINT_VAR(CMAKE_MODULE_PATH)
PRINT_VAR(USE_XSDK_DEFAULTS)
PRINT_VAR(XSDK_USE_COMPILER_ENV_VARS)

INCLUDE("CMakeForceCompiler")

PROJECT(MY_PROJ NONE)

# A) Determine if to set compiler defaults from env var.

SET(GET_COMPILER_DEFAULTS_FROM_ENV  TRUE)
IF (USE_XSDK_DEFAULTS  AND  NOT  XSDK_USE_COMPILER_ENV_VARS)
  SET(GET_COMPILER_DEFAULTS_FROM_ENV  FALSE)
ENDIF()

# B) Set defaults from env vars if asked and otherwise ignore the env vars
# (which goes against default CMake behavior),

IF (GET_COMPILER_DEFAULTS_FROM_ENV)
  IF (NOT "$ENV{CXX}" STREQUAL "" AND "${CMAKE_CXX_COMPILER}" STREQUAL "")
    MESSAGE("Setting CMAKE_CXX_COMPILER from env var CXX='$ENV{CXX}'!")
    SET(CMAKE_CXX_COMPILER "$ENV{CXX}" CACHE FILEPATH "Set from env var CXX")  
  ENDIF()
ELSE()
  IF (NOT "$ENV{CXX}" STREQUAL "" AND "${CMAKE_CXX_COMPILER}" STREQUAL "")
    MESSAGE("NOT setting CMAKE_CXX_COMPILER from env var CXX='$ENV{CXX}'!")
    # Got to find the default C++ compiler so this does not pick up the CXX
    # set in the env!
    FIND_PROGRAM( DEFAULT_CXX_COMPILER  NAMES  c++  g++ )
    SET(CMAKE_CXX_COMPILER "${DEFAULT_CXX_COMPILER}" CACHE FILEPATH
      "Ignoring default set by env var CXX")  
  ENDIF()
ENDIF()


MESSAGE("Before: CMAKE_CXX_COMPILER = '${CMAKE_CXX_COMPILER}'") 
MESSAGE("Before: CMAKE_CXX_FLAGS = '${CMAKE_CXX_FLAGS}'") 
MESSAGE("Before: CMAKE_CXX_FLAGS_DEBUG = '${CMAKE_CXX_FLAGS_DEBUG}'") 
MESSAGE("Before: CMAKE_CXX_FLAGS_RELEASE = '${CMAKE_CXX_FLAGS_RELEASE}'") 
MESSAGE("Before: BUILD_SHARED_LIBS = '${BUILD_SHARED_LIBS}'")


IF (CMAKE_CXX_COMPILER STREQUAL "CMAKE_CXX_COMPILER_HAS_NOT_BEEN_SET")
  MESSAGE(FATAL_ERROR "CMAKE_CXX_COMPILER is not set by the user, aborting!")
ELSEIF(CMAKE_CXX_COMPILER STREQUAL "")
  MESSAGE(FATAL_ERROR "CMAKE_CXX_COMPILER was set by user to empty '', aborting!")
ENDIF()


ENABLE_LANGUAGE(CXX)

MESSAGE("After: CMAKE_CXX_COMPILER = '${CMAKE_CXX_COMPILER}'") 
MESSAGE("After: CMAKE_CXX_FLAGS = '${CMAKE_CXX_FLAGS}'") 
MESSAGE("After: CMAKE_CXX_FLAGS_DEBUG = '${CMAKE_CXX_FLAGS_DEBUG}'") 
MESSAGE("After: CMAKE_CXX_FLAGS_RELEASE = '${CMAKE_CXX_FLAGS_RELEASE}'") 
MESSAGE("After: BUILD_SHARED_LIBS = '${BUILD_SHARED_LIBS}'")
MESSAGE("After: CMAKE_CXX_COMPILER_ID = '${CMAKE_CXX_COMPILER_ID}'") 
